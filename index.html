<script>
  const btn = document.getElementById('send');
  const statusEl = document.getElementById('status');

  btn.addEventListener('click', async () => {
    btn.disabled = true;
    statusEl.textContent = 'é€ä¿¡ä¸­â€¦';

    const tenant = (document.getElementById('tenant')?.value || 'salon-booking').trim();
    const toolId = (document.getElementById('toolId')?.value || 'tool_salon_booking_v1').trim();
    const name   = document.getElementById('name').value.trim();
    const email  = document.getElementById('email').value.trim();
    const memo   = document.getElementById('notes').value.trim();   // â† ã‚µãƒ¼ãƒå´ã¯ memo ã‚’è¦‹ã‚‹
    const channel= document.getElementById('channel').value;

    const body = {
      action: 'saveLead',
      payload: { toolId, name, email, memo, channel, ua: navigator.userAgent, ts: new Date().toISOString() },
      tenant
    };

    try {
      const res = await fetch('/api', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'x-tenant-id': tenant },
        body: JSON.stringify(body),
      });
      const json = await res.json().catch(() => ({}));
      if (res.ok && json.ok !== false) {
        statusEl.innerHTML = '<span class="ok">ä¿å­˜å®Œäº†ï¼</span> å–¶æ¥­ã‚ªãƒ¼ãƒˆãƒ¡ã®æ­¯è»Šã€å›ã‚Šå‡ºã—ãŸã‚ˆğŸ‰';
      } else {
        statusEl.innerHTML = '<span class="err">ä¿å­˜å¤±æ•—â€¦</span> ' + (json.error || ('HTTP ' + res.status));
      }
    } catch (e) {
      statusEl.innerHTML = '<span class="err">é€ä¿¡ã‚¨ãƒ©ãƒ¼</span> ' + e.message;
    } finally {
      btn.disabled = false;
    }
  });
</script>
