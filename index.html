<script>
  const btn = document.getElementById('send');
  const statusEl = document.getElementById('status');

  btn.addEventListener('click', async () => {
    btn.disabled = true;
    statusEl.textContent = '送信中…';

    const tenant = (document.getElementById('tenant')?.value || 'salon-booking').trim();
    const toolId = (document.getElementById('toolId')?.value || 'tool_salon_booking_v1').trim();
    const name   = document.getElementById('name').value.trim();
    const email  = document.getElementById('email').value.trim();
    const memo   = document.getElementById('notes').value.trim();   // ← サーバ側は memo を見る
    const channel= document.getElementById('channel').value;

    const body = {
      action: 'saveLead',
      payload: { toolId, name, email, memo, channel, ua: navigator.userAgent, ts: new Date().toISOString() },
      tenant
    };

    try {
      const res = await fetch('/api', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'x-tenant-id': tenant },
        body: JSON.stringify(body),
      });
      const json = await res.json().catch(() => ({}));
      if (res.ok && json.ok !== false) {
        statusEl.innerHTML = '<span class="ok">保存完了！</span> 営業オートメの歯車、回り出したよ🎉';
      } else {
        statusEl.innerHTML = '<span class="err">保存失敗…</span> ' + (json.error || ('HTTP ' + res.status));
      }
    } catch (e) {
      statusEl.innerHTML = '<span class="err">送信エラー</span> ' + e.message;
    } finally {
      btn.disabled = false;
    }
  });
</script>
